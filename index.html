<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSRT Studio CapCut-Style Modern</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { margin:0; font-family:sans-serif; background:#111; color:white; overflow:hidden; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#1a1a1a; box-shadow:0 2px 8px rgba(0,0,0,0.5);}
button,input,select { transition: all 0.3s; cursor:pointer; }
button:hover,input:hover,select:hover { transform: scale(1.05); }
#canvasContainer { position:relative; width:100%; height:60vh; margin-top:10px; background:linear-gradient(135deg,#222,#111); border-radius:12px; overflow:hidden; }
canvas { width:100%; height:100%; display:block; }
.layer { position:absolute; pointer-events:none; }
.timelineContainer { height:120px; background:#1c1c1c; margin-top:10px; padding:10px; border-radius:12px; display:flex; flex-direction:column; }
.timeline { flex:1; overflow-x:auto; white-space:nowrap; position:relative; border-radius:8px; background:#222; }
.marker { display:inline-block; width:2px; height:100%; background:red; position:absolute; }
.lyric { position:absolute; color:#0ff; font-size:24px; font-weight:bold; text-shadow:1px 1px 5px black; pointer-events:none; }
.sidebar { position:absolute; top:10px; right:10px; width:220px; max-height:80%; overflow-y:auto; background:#1a1a1a; border-radius:12px; padding:10px; }
.effectCard { width:90px; height:90px; margin:5px; background:#333; border-radius:12px; display:flex; justify-content:center; align-items:center; text-align:center; font-size:12px; cursor:pointer; transition:0.3s; }
.effectCard:hover { background:#555; transform:scale(1.05); }
.controlPanel { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px; }
.controlPanel button { padding:8px 12px; border-radius:8px; background:#333; }
.controlPanel button:hover { background:#555; }
</style>
</head>
<body>

<header>
  <h1 class="text-xl font-bold">DSRT Studio Modern</h1>
  <div class="flex gap-2">
    <button onclick="undo()">Undo</button>
    <button onclick="redo()">Redo</button>
  </div>
</header>

<div id="canvasContainer">
  <canvas id="canvas"></canvas>
  <div id="layerContainer"></div>
  <div id="lyricContainer"></div>
  <div class="sidebar" id="effectPanel">
    <div class="effectCard" onclick="applyTemplate('jedag')">Jedag-Jedug</div>
    <div class="effectCard" onclick="applyTemplate('lyric')">Lyric</div>
    <div class="effectCard" onclick="applyTemplate('glitch')">Glitch</div>
    <div class="effectCard" onclick="applyTemplate('shake')">Shake</div>
    <div class="effectCard" onclick="applyTemplate('glow')">Glow</div>
    <div class="effectCard" onclick="applyTemplate('particle')">Particle</div>
    <input type="file" id="uploadImage" accept="image/*" class="mt-2 bg-gray-700 p-2 rounded w-full"/>
    <input type="file" id="uploadAudio" accept="audio/*" class="mt-2 bg-gray-700 p-2 rounded w-full"/>
    <select id="resolutionSelect" class="mt-2 bg-gray-700 p-2 rounded w-full">
      <option value="640x360">360p</option>
      <option value="1280x720">720p</option>
      <option value="1920x1080">1080p</option>
    </select>
    <button id="downloadBtn" class="mt-2 w-full bg-purple-600 p-2 rounded">Download Video</button>
  </div>
</div>

<div class="timelineContainer">
  <div class="timeline" id="timeline"></div>
</div>

<div class="controlPanel">
  <button id="playBtn">Play</button>
  <button id="pauseBtn">Pause</button>
  <button id="stopBtn">Stop</button>
</div>

<script>
// Canvas setup
const canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d');
let img=new Image();
let originalData=null;
const layerContainer=document.getElementById('layerContainer');
const lyricContainer=document.getElementById('lyricContainer');

document.getElementById('uploadImage').addEventListener('change', e=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{ img.src=ev.target.result; }
  reader.readAsDataURL(file);
});
img.onload=function(){
  canvas.width=img.width; canvas.height=img.height;
  ctx.drawImage(img,0,0);
  originalData=ctx.getImageData(0,0,canvas.width,canvas.height);
  saveHistory();
}

// Undo/Redo
let history=[], historyIndex=-1;
function saveHistory(){ history=history.slice(0,historyIndex+1); history.push(ctx.getImageData(0,0,canvas.width,canvas.height)); historyIndex++; }
function undo(){ if(historyIndex>0){ historyIndex--; ctx.putImageData(history[historyIndex],0,0); }}
function redo(){ if(historyIndex<history.length-1){ historyIndex++; ctx.putImageData(history[historyIndex],0,0); }}

// Audio
let audio=new Audio();
document.getElementById('uploadAudio').addEventListener('change', e=>{
  const file=e.target.files[0]; if(!file) return;
  audio.src=URL.createObjectURL(file);
});

// Templates & Effects
let lyrics=[{time:1,text:"DSRT Studio"},{time:3,text:"Ultimate Pro"},{time:5,text:"CapCut Modern"}];
let effectInterval=null;
function applyTemplate(name){
  if(!audio.paused){ clearInterval(effectInterval); }
  effectInterval=setInterval(()=>{
    const t=Math.floor(audio.currentTime);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);
    if(name==='jedag'){ ctx.globalAlpha=0.5+Math.random()*0.5; }
    if(name==='glitch'){ ctx.drawImage(img,Math.random()*10-5,Math.random()*10-5); }
    if(name==='shake'){ canvas.style.transform='translate('+(Math.random()*10-5)+'px,'+(Math.random()*10-5)+'px)'; }
    if(name==='glow'){ canvas.style.boxShadow='0 0 '+(Math.random()*20)+'px #0ff'; }
    if(name==='lyric'){ lyricContainer.innerHTML=''; lyrics.forEach(l=>{
      if(t>=l.time && t<l.time+2){
        const div=document.createElement('div');
        div.className='lyric';
        div.style.top=(50+Math.random()*100)+'px';
        div.style.left=(50+Math.random()*400)+'px';
        div.innerText=l.text;
        lyricContainer.appendChild(div);
      }
    })}
  },50);
}

// Controls
document.getElementById('playBtn').addEventListener('click', ()=>{ audio.play(); });
document.getElementById('pauseBtn').addEventListener('click', ()=>{ audio.pause(); });
document.getElementById('stopBtn').addEventListener('click', ()=>{
  audio.pause(); audio.currentTime=0; canvas.style.transform=''; canvas.style.boxShadow=''; lyricContainer.innerHTML=''; clearInterval(effectInterval);
});

// Download Video (5 detik demo)
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const stream=canvas.captureStream(30);
  const recorder=new MediaRecorder(stream);
  let chunks=[];
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=e=>{
    const blob=new Blob(chunks,{type:'video/webm'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='dsrt_modern.webm'; a.click();
    URL.revokeObjectURL(url);
  };
  recorder.start();
  setTimeout(()=>{ recorder.stop(); },5000);
});
</script>

</body>
</html>
